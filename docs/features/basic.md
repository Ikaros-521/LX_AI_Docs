# 基础功能

## 统一配置

统一配置是系统的全局设置，用于管理系统级别的参数和选项。

### 配置项说明

- **系统设置**
    - 系统名称：显示在界面标题和日志中的系统名称
    - 调试模式：是否启用调试日志
    - 日志级别：系统日志的详细程度

- **任务配置**
    - 任务队列大小：系统可以同时处理的最大任务数
    - 任务超时时间：单个任务的最大执行时间
    - 重试策略：任务失败后的重试机制

### 使用说明

1. 访问统一配置页面
2. 修改相关参数
3. 保存配置（部分配置可能需要重启服务生效）

## 配置管理

配置管理用于管理不同场景下的配置组合，支持多配置切换和导入导出。

### 配置列表

在配置列表中，您可以：

1. 创建新配置
      - 点击"新建配置"按钮
      - 填写配置名称和说明
      - 选择平台和功能模块
      - 设置具体参数

2. 管理现有配置
      - 编辑：修改配置内容
      - 删除：移除不需要的配置


## 功能管理

### 1. 消息优先级

消息优先级功能用于管理不同类型消息的处理顺序,通过设置优先级数值来控制消息的播放顺序。

#### 基本原则
   - 优先级使用正整数表示
   - 数字越大优先级越高,越早播放
   - 相同优先级的消息按接收顺序播放

#### 支持的消息类型

1. **互动消息**
      - 弹幕回复: 对用户弹幕的回复
      - LLM回复: AI大语言模型的回复
      - 念弹幕: 直接朗读用户的弹幕内容

2. **答谢消息**
      - 入场答谢: 感谢用户进入直播间
      - 礼物答谢: 感谢用户赠送礼物
      - 关注答谢: 感谢用户关注主播

3. **任务消息**
      - 复读-文案: 复读功能发送的文案
      - 闲时任务-文案: 闲时任务发送的文案
      - 定时任务-文案: 定时任务发送的文案
      - 本地问答-文案: 本地问答功能的回复文案

#### 优先级设置建议

1. **高优先级消息** (建议20-30)
      - 礼物答谢
      - LLM回复
      - 本地问答-文案
      - 复读-文案
      
2. **中优先级消息** (建议10-19)
      - 弹幕回复
      - 关注答谢
      - 入场答谢
      - 念弹幕

3. **低优先级消息** (建议1-9)
      - 闲时任务-文案
      - 定时任务-文案

#### 使用场景

1. **礼物互动优先**
      - 将礼物答谢设为最高优先级
      - 确保及时感谢打赏用户
      - 提升用户打赏积极性

2. **对话流畅性**
      - 提高弹幕回复和LLM回复优先级
      - 保证对话的连贯性
      - 增强互动的即时性

3. **基础任务保障**
      - 降低自动任务的优先级
      - 避免打断重要互动
      - 保证基础任务正常执行

#### 使用建议

1. **优先级分配**
      - 根据直播间实际情况调整优先级
      - 保持适当的优先级差距
      - 避免过多消息使用相同优先级

2. **数值设置**
      - 建议使用10的倍数设置基准优先级
      - 预留优先级调整空间
      - 重要消息类型之间保持10-20的优先级差距

3. **动态调整**
      - 观察消息处理效果
      - 根据直播节奏调整优先级
      - 特殊活动时可临时调整优先级

4. **注意事项**
      - 优先级设置过于集中可能导致消息堆积
      - 过大的优先级差距可能导致低优先级消息长期得不到处理
      - 建议定期检查和优化优先级设置

### 2. 消息过滤

消息过滤功能用于管理和控制直播间的消息流,通过多种过滤机制来保证消息质量和处理效率。

#### 基础设置

1. **触发&过滤前后缀**
      - **弹幕触发前缀**: 必须包含指定前缀才能触发(每行一个)
      - **弹幕触发后缀**: 必须包含指定后缀才能触发(每行一个)
      - **弹幕过滤前缀**: 包含指定前缀的消息将被过滤(每行一个)
      - **弹幕过滤后缀**: 包含指定后缀的消息将被过滤(每行一个)
      - **LLM触发前缀**: 触发大语言模型回复的前缀(每行一个)
      - **LLM触发后缀**: 触发大语言模型回复的后缀(每行一个)

2. **消息长度限制**
      - **最大单词数**: 限制大语言模型回复的最大单词数
      - **最大字符数**: 限制大语言模型回复的最大字符数
      - 注意: 流式输出模式下不会进行限制

3. **数据转换与特殊内容处理**
      - **音频合成前的文本切分**: 将长文本按标点符号切分成短句
      - **用户名中的数字转中文**: 将用户名中的数字转换为中文读音
      - **弹幕表情过滤**: 过滤掉弹幕中的表情符号

4. **消息遗忘&保留设置**
      支持以下消息类型的遗忘间隔和保留数量设置:
      - 弹幕消息
      - 礼物消息
      - 入场消息
      - 关注消息
      - 聊天消息
      - 定时任务
      - 点赞消息
      - 闲时任务
      - 图像识别(暂无)

5. **弹幕黑名单**
      - 黑名单开关: 控制是否启用黑名单功能
      - 黑名单用户列表: 配置需要过滤的用户名(每行一个)

#### 过滤机制说明

1. **前后缀过滤**
      - 触发前缀示例: 配置"#"，则"#你好"会被触发
      - 触发后缀示例: 配置"。"，则"你好。"会被触发
      - 过滤前缀示例: 配置"@"，则"@你好"会被过滤
      - 过滤后缀示例: 配置"?"，则"你好?"会被过滤

2. **消息遗忘机制**
      - 遗忘间隔: 设置消息在队列中的保留时间(秒)
      - 保留数量: 设置队列中最多保留的消息数量
      - 超过间隔或数量的消息将被自动清理

3. **黑名单机制**
      - 完全匹配: 用户名需要完全匹配才会被过滤

#### 使用场景

1. **直播互动优化**
      - 过滤无效弹幕
      - 控制互动频率
      - 维护直播间秩序

2. **性能优化**
      - 控制消息队列大小
      - 避免消息堆积
      - 优化处理效率

3. **内容管理**
      - 过滤不当内容
      - 屏蔽特定用户
      - 控制互动质量

#### 使用建议

1. **前后缀设置**
      - 根据直播需求设置合适的触发条件
      - 避免过于严格的过滤规则
      - 定期更新过滤规则

2. **遗忘参数配置**
      - 根据直播间活跃度调整遗忘间隔
      - 合理设置保留数量
      - 不同类型消息可以设置不同参数

3. **黑名单管理**
      - 及时更新黑名单列表
      - 记录违规用户信息
      - 定期清理过期记录

4. **注意事项**
      - 过滤规则不要过于复杂
      - 定期检查过滤效果
      - 及时调整配置参数
      - 保持黑名单的时效性

### 3. 违禁词设置

违禁词功能用于自动过滤和处理直播间中的不当内容,通过配置违禁词库和处理机制来维护直播间的良好环境。

#### 基础设置

1. **违禁词处理机制**
      - **违禁词替换**: 将违禁词替换为指定的文本内容
      - **违禁语句丢弃**: 含有违禁词的整句话将被丢弃
      - **不处理违禁词**: 关闭违禁词处理功能

2. **替换内容**
      - 在选择"违禁词替换"机制时使用
      - 设置将违禁词替换成的文本内容
      - 为空时将直接删除违禁词

#### 违禁词管理

1. **添加违禁词**
      - 单个添加: 手动输入违禁词
      - 批量导入: 支持批量导入违禁词列表
      - 记录信息: 自动记录添加时间和操作用户

2. **删除操作**
      - 单个删除: 删除指定的违禁词
      - 批量删除: 删除选中的多个违禁词
      - 清空操作: 清空所有违禁词(不可恢复)

3. **查询功能**
      - 违禁词搜索: 支持关键词搜索
      - 时间范围: 可按添加时间筛选
      - 分页显示: 支持自定义每页显示数量

#### 处理机制说明

1. **违禁词替换模式**
      - 仅替换命中的违禁词部分
      - 其他内容保持不变
      - 示例: 
        - 违禁词: "坏话"
        - 替换为: "***"
        - 原文: "这是一句坏话"
        - 结果: "这是一句***"

2. **语句丢弃模式**
      - 发现违禁词即丢弃整句
      - 不进行部分替换
      - 示例:
        - 违禁词: "坏话"
        - 原文: "这是一句坏话"
        - 结果: ""(整句被丢弃)

3. **不处理模式**
      - 仅记录违禁词
      - 不进行任何处理
      - 用于数据统计和分析

#### 使用场景

1. **内容净化**
      - 过滤不文明用语
      - 屏蔽敏感词汇
      - 维护直播环境

2. **合规管理**
      - 遵守平台规范
      - 预防违规内容
      - 降低运营风险

3. **数据分析**
      - 统计违禁词出现频率
      - 分析用户行为
      - 优化管理策略

#### 使用建议

1. **词库管理**
      - 及时更新违禁词库
      - 分类管理不同类型的违禁词
      - 定期清理过期或无效的违禁词

2. **机制选择**
      - 根据直播内容选择合适的处理机制
      - 避免过于严格影响用户体验
      - 可针对不同场景切换不同机制

3. **效果监控**
      - 定期检查过滤效果
      - 收集用户反馈
      - 及时调整处理策略

4. **注意事项**
      - 违禁词设置要合理,避免误伤
      - 定期备份违禁词库
      - 清空操作需谨慎,不可恢复
      - 建议保留操作日志

### 4. 弹幕&回复模板

弹幕&回复模板功能用于统一管理和格式化各类消息的展示形式,包括念弹幕、弹幕模板和LLM回复模板三个子功能。

#### 基础设置
- **总开关**: 控制所有弹幕&回复模板功能的启用/禁用状态
- 只有开启总开关后,各子功能的配置才会生效

#### 功能模块

1. **念弹幕功能**
      - **功能开关**: 单独控制念弹幕功能的启用/禁用
      - **用户名最大长度**: 限制显示的用户名长度,超过将被截断
      - **文案配置**: 设置念弹幕时的文案格式
      - **使用场景**: 将用户弹幕内容以特定格式朗读出来

2. **弹幕模板功能**
      - **功能开关**: 单独控制弹幕模板功能的启用/禁用
      - **用户名最大长度**: 限制显示的用户名长度,超过将被截断
      - **文案配置**: 设置弹幕显示的模板格式
      - **使用场景**: 统一格式化直播间内的弹幕显示样式

3. **LLM回复模板功能**
      - **功能开关**: 单独控制LLM回复模板功能的启用/禁用
      - **用户名最大长度**: 限制显示的用户名长度,超过将被截断
      - **文案配置**: 设置AI回复的模板格式
      - **使用场景**: 统一格式化AI的回复内容
      - **注意**: 在流式响应模式下此功能无效

#### 文案编写规则

1. **基础规则**
      - 支持多行配置,每行一条文案
      - 系统会从配置的文案中随机选择一条
      - 所有文案用完后会自动重新开始

2. **动态变量**
      支持以下变量替换:
      - `{username}`: 发送消息的用户名
      - `{comment}`: 用户发送的弹幕内容(念弹幕功能专用)
      - `{content}`: AI的回复内容(LLM回复模板专用)

3. **随机语法**
      支持使用`[选项1|选项2|选项3]`格式来随机选择内容

      示例:
      ```
      念弹幕: [听说|看到]{username}说:{comment}
      弹幕模板: {username}[悄悄地|开心地]说:{comment}
      LLM回复: [让我想想|我觉得]{content}
      ```

#### 使用场景

1. **统一展示风格**
      - 保持直播间消息格式统一
      - 提升观看体验
      - 突出重要信息

2. **增强互动效果**
      - 通过随机语法增加变化
      - 避免机械化的回复
      - 提升互动的趣味性

3. **品牌个性化**
      - 定制符合个人风格的模板
      - 打造独特的直播间氛围
      - 增强品牌识别度

#### 使用建议

1. **模板设计**
      - 设计简洁清晰的模板
      - 保持风格统一
      - 突出重要信息
      - 避免过于复杂的格式

2. **文案编写**
      - 准备充足的随机文案
      - 合理使用随机语法
      - 保持语气自然友好
      - 注意礼貌用语

3. **长度控制**
      - 合理设置用户名长度限制
      - 避免过长的模板格式
      - 保持信息的简洁性

4. **运行维护**
      - 定期更新文案内容
      - 检查模板效果
      - 收集用户反馈
      - 及时调整配置

5. **注意事项**
      - 不同功能使用对应的变量
      - 注意流式响应模式的限制
      - 避免模板之间的冲突
      - 定期检查模板运行效果

### 5. 答谢功能

答谢功能是一个自动感谢系统,用于对观众的互动行为进行及时回应,增强直播间的互动氛围。

#### 基础设置
- **答谢总开关**: 控制所有答谢功能的启用/禁用状态
- 只有开启总开关后,配置的答谢功能才会生效

#### 支持的答谢类型

1. **入场答谢**
      - 功能开关: 单独控制入场答谢的启用/禁用
      - 选取模式: 随机/顺序选取文案
      - 触发时机: 用户进入直播间时
      - 动态变量: `{username}` 用于替换用户名

2. **礼物答谢**
      - 功能开关: 单独控制礼物答谢的启用/禁用
      - 选取模式: 随机/顺序选取文案
      - 触发条件: 礼物价值达到设定的最低答谢价格
      - 动态变量: 
        - `{username}`: 赠送礼物的用户名
        - `{gift_name}`: 礼物名称
        - `{unit_price}`: 礼物单价
        - `{total_price}`: 礼物总价值
        - `{gift_num}`: 礼物数量

3. **关注答谢**
      - 功能开关: 单独控制关注答谢的启用/禁用
      - 选取模式: 随机/顺序选取文案
      - 触发时机: 用户关注主播时
      - 动态变量: `{username}` 用于替换用户名

#### 文案编写规则

1. **基础规则**
      - 支持多条文案,每行一条
      - 随机模式: 从所有文案中随机选择
      - 顺序模式: 按顺序循环使用文案
      - 文案用完后会自动重新开始

2. **动态变量**
      每种答谢类型支持不同的动态变量,使用`{变量名}`格式

3. **随机语法**
      支持使用`[选项1|选项2|选项3]`格式来随机选择内容

      示例:
      ```
      感谢[可爱的|善良的|热情的]{username}[进入直播间|来到直播间]~
      感谢{username}赠送的{gift_num}个{gift_name},[太棒了|好开心|非常感谢]!
      [欢迎|感谢]{username}[关注|订阅]主播,[一起来玩吧|请多关照]~
      ```

#### 使用场景

1. **提升互动体验**
      - 及时回应用户行为
      - 增强用户参与感
      - 营造温馨的直播氛围

2. **礼物激励**
      - 及时感谢打赏用户
      - 设置合理的最低答谢门槛
      - 鼓励用户互动打赏

3. **粉丝维护**
      - 对新关注用户表示感谢
      - 增加用户归属感
      - 提高粉丝留存率

#### 使用建议

1. **开关管理**
      - 根据直播需求灵活开启/关闭各类答谢
      - 避免过多答谢影响直播节奏
      - 合理使用随机/顺序模式

2. **文案编写**
      - 准备充足的文案内容
      - 善用随机语法增加变化
      - 保持文案风格统一
      - 注意礼貌用语
      - 避免过于机械的表达

3. **礼物答谢设置**
      - 合理设置最低答谢价格
      - 可以针对不同价值礼物准备不同档次文案
      - 高价值礼物建议使用更热情的答谢方式

4. **运行维护**
      - 定期更新文案内容
      - 观察答谢效果
      - 及时调整配置
      - 注意避免重复答谢

### 6. 闲时任务

闲时任务用于在直播间互动较少时维持活跃度,可以自动发送预设的话术内容。

#### 基础设置
- **闲时任务总开关**: 控制所有闲时任务的启用/禁用状态
- 只有开启总开关后,配置的闲时任务才会生效

#### 运行机制
支持三种运行机制:

1. **直播间无消息更新闲时**  
      - 根据设定的时间范围触发任务
      - 可以设置哪些类型的消息会刷新计时:
        - 弹幕消息
        - 礼物消息
        - 入场消息
        - 关注消息
      - 配置项:
        - 最小闲时时间: 两次触发的最短间隔(秒)
        - 最大闲时时间: 两次触发的最长间隔(秒)
        - 闲时计时减小到: 收到消息时重置的时间值
        - 刷新计时的消息类型: 勾选需要响应的消息类型

2. **待合成消息队列更新闲时**  
      - 监控待合成消息队列的长度
      - 当队列长度小于设定值时触发任务
      - 配置项:
        - 待合成消息队列个数小于此值时触发: 触发任务的队列长度阈值

3. **待播放音频队列更新闲时**  
      - 监控待播放音频队列的长度
      - 当队列长度小于设定值时触发任务
      - 配置项:
        - 待播放音频队列个数小于此值时触发: 触发任务的队列长度阈值
      - 注意: 此机制需要配合定制版LiveTalking才能生效

#### 触发内容配置

1. **文案模式**
      - 开关控制: 可单独启用/禁用文案模式
      - 文案组管理:
        - 支持创建多个文案组
        - 每个组可以设置:
          - 组名称: 方便管理和识别
          - 排序: 决定触发顺序
          - 提取方式: 随机/顺序
          - 文案内容: 每行一条

2. **弹幕触发LLM模式**
      - 开关控制: 可单独启用/禁用弹幕模式
      - 提取方式: 随机/固定顺序
      - 弹幕列表: 配置预设的弹幕内容(每行一条)

#### 文案编写规则

1. **基础规则**
      - 支持多条文案,每行一条
      - 系统会根据设置随机或顺序发送
      - 文案组用完后会自动重新开始

2. **动态变量**
      文案中可以使用以下变量:
      - `{cur_time}` 或 `{time}`: 当前北京时间
      - `{last_username}`: 最后发言的用户名
      - `{user_num}`: 当前在线用户数(仅抖音/TikTok平台支持)

3. **随机语法**
      支持使用`[选项1|选项2|选项3]`格式来随机选择内容

      示例:
      ```
      现在是{time},[好安静|好冷清]呀~
      [有人在吗|还有人在看直播吗]?
      ```

#### 使用场景

1. **维持直播间活跃**
      - 在直播间互动较少时自动发送话术
      - 避免直播间过于安静

2. **商品推广**
      - 定期发送商品介绍
      - 保持商品曝光度
      - 可以设置多个商品话术轮换

3. **互动引导**
      - 引导观众互动
      - 活跃直播间氛围
      - 增加用户粘性

#### 使用建议

1. **机制选择**
      - 根据实际需求选择合适的运行机制
      - 新手建议使用"直播间无消息更新闲时"
      - 合理设置触发阈值,避免过于频繁

2. **时间设置**
      - 最小间隔建议不低于5秒
      - 最大间隔建议不超过300秒
      - 根据直播间实际情况调整（如果拿闲时任务做主要话术来播放，那不建议通过时间来限制任务触发，而是改用队列长度来限制）

3. **内容编排**
      - 准备充足的文案内容
      - 合理分组和排序
      - 适当使用随机语法增加变化
      - 内容要自然,避免机械感

4. **运行维护**
      - 定期检查任务运行状态
      - 及时更新文案内容
      - 观察效果及时调整配置

### 7. 定时任务

定时任务用于按照预设规则自动发送话术,让直播间保持活跃度。

#### 基础设置
- **定时任务总开关**: 控制所有定时任务的启用/禁用状态
- 只有开启总开关后,配置的定时任务才会生效

#### 任务管理
在任务列表页面可以进行以下操作:
- 添加新任务
- 编辑已有任务
- 删除任务
- 批量删除任务

#### 任务配置项
每个定时任务需要配置以下内容:
- **触发类型**: 目前支持"发送文案"
- **触发周期最小值**: 两次触发之间的最短时间(秒)
- **触发周期最大值**: 两次触发之间的最长时间(秒)
- **文案内容**: 要发送的话术内容

#### 文案编写规则
1. **基础规则**
      - 支持多条文案,每行一条
      - 系统会随机抽取一条发送
      - 已发送的文案会被临时移除,避免重复
      - 所有文案发送完后会重新开始

2. **动态变量**
      文案中可以使用以下变量:
      - `{cur_time}` 或 `{time}`: 当前北京时间
      - `{last_username}`: 最后发言的用户名
      - `{user_num}`: 当前在线用户数(仅抖音/TikTok平台支持)

3. **随机语法**
      支持使用`[选项1|选项2|选项3]`格式来随机选择内容

      示例:
      ```
      欢迎来到[小主播|主播]的直播间~
      今天[好热|好冷|天气真好]呀
      ```

#### 使用场景
1. **维持直播间活跃**
      - 在直播间互动较少时自动发送话术
      - 保持直播间的活跃氛围

2. **商品推广**
      - 定期发送商品介绍
      - 保持商品曝光度
      - 可以设置多个不同文案轮换发送

3. **规则提醒**
      - 定时发送直播间规则
      - 友好提醒观众遵守规范
      - 维护直播间秩序

#### 使用建议
1. **时间设置**
      - 建议最小间隔不要低于60秒
      - 最大间隔建议不超过300秒
      - 根据直播间实际情况调整

2. **文案编写**
      - 准备多条不同内容的文案
      - 善用随机语法增加变化
      - 内容要自然,避免机械感

3. **运行维护**
      - 定期检查任务运行状态
      - 及时更新文案内容
      - 根据效果调整触发时间

### 8. 本地问答

本地问答系统用于自动回复用户的问题,通过关键词匹配来触发预设的回答内容。

#### 基础设置
- **本地问答总开关**: 控制所有本地问答的启用/禁用状态
- **匹配算法**: 可选择以下两种匹配方式
  - 相似度匹配: 计算输入文本与每个关键词的相似度,适用于需要精确匹配的场景
  - 模糊匹配: 先检查关键词是否包含在输入中再计算相似度,适用于部分匹配的场景

#### 问答管理
在问答列表页面可以进行以下操作:
- 添加新问答
- 编辑已有问答
- 删除问答
- 批量删除问答

#### 配置项说明
每个问答需要配置以下内容:
- **触发类型**: 目前支持"发送文案"
- **最低相似/匹配度**: 设置触发回答的最低匹配程度
- **关键词**: 触发回答的关键词列表(每行一个)
- **回答内容**: 匹配成功后发送的回答内容

#### 文案编写规则
1. **基础规则**
      - 支持多条回答文案,每行一条
      - 系统会随机抽取一条发送
      - 支持多个关键词,每行一个
      - 任一关键词匹配达到相似度要求即可触发

2. **动态变量**
      回答内容中可以使用以下变量:
      - `{username}`: 提问用户的用户名
      - `{cur_time}` 或 `{time}`: 当前北京时间

3. **随机语法**
      支持使用`[选项1|选项2|选项3]`格式来随机选择内容

      示例:
      ```
      感谢[亲爱的|可爱的]{username}提问~
      现在是{time},我来为您解答[这个|这样的]问题
      ```

#### 使用场景
1. **常见问题解答**
      - 设置常见问题的关键词和答案
      - 自动回复重复性问题
      - 减轻人工回答压力

2. **直播间引导**
      - 回答直播间规则相关问题
      - 解答商品相关咨询
      - 活动玩法说明

3. **互动增强**
      - 设置趣味性的问答
      - 增加直播间的互动性
      - 活跃直播间氛围

#### 使用建议
1. **关键词设置**
      - 设置多个相近的关键词形式
      - 考虑用户可能的不同表达方式
      - 适当调整最低匹配度阈值

2. **回答编写**
      - 准备多个不同的回答版本
      - 使用随机语法增加变化
      - 回答要自然友好,避免机械感

3. **运行维护**
      - 定期检查匹配效果
      - 及时更新问答内容
      - 根据实际效果调整配置

## 最佳实践

1. 配置管理
      - 定期备份配置
      - 使用模板快速部署
      - 及时更新配置

2. 性能优化
      - 合理设置优先级
      - 适当的过滤规则
      - 控制任务频率

3. 内容管理
      - 定期更新违禁词库
      - 优化回复模板
      - 维护问答库

## 常见问题

1. 配置不生效
      - 检查配置格式
      - 确认保存成功
      - 可能需要重启服务

2. 任务执行异常
      - 查看错误日志
      - 检查触发条件
      - 验证配置正确性

3. 性能问题
      - 优化过滤规则
      - 调整任务频率
      - 清理历史数据